INCLUDES += protobuf/libwebsockets

LIBWSSRCS := $(addprefix protobuf/libwebsockets/lib/, \
	base64-decode.c  \
	client.c \
	client-handshake.c \
	client-parser.c \
	daemonize.c \
	extension.c \
	extension-deflate-frame.c \
	extension-deflate-stream.c \
	getifaddrs.c \
	handshake.c \
	libwebsockets.c \
	output.c \
	parsers.c \
	server.c \
	server-handshake.c \
	sha-1.c)

USERSRCS += $(LIBWSSRCS)

$(call TOOBJSDEPS, $(LIBWSSRCS)) : EXTRAFLAGS=-fPIC -DCMAKE_BUILD \
	 -Iprotobuf/libwebsockets/build \
	 -Iprotobuf/libwebsockets

TARGETS += ../lib/libwebsockets.so ../lib/libwebsockets.so.0

../lib/libwebsockets.so.0: $(call TOOBJS, $(LIBWSSRCS))
	$(ECHO) Linking $(notdir $@)
	@mkdir -p ../lib
	@rm -f $@
	$(CC) -g $(LDFLAGS) -Wl,-soname,$(notdir $@) -shared -o $@ $^

../include/%.h: ./protobuf/libwebsockets/%.h
	cp $^ $@
