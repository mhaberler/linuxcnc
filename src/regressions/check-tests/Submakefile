
ifeq ($(USE_CHECK),yes)

INCLUDES += $(CHECK_TESTS)

../include/%.h: ./$(CHECK_DIR)/%.h
	cp $^ $@

$(call TOOBJSDEPS, $(HALTALK_SRCS)) : EXTRAFLAGS += $(HALTALK_CXXFLAGS)

TESTS = check_hal
check_PROGRAMS = ../bin/check_hal 
check_hal_SOURCES = $(addprefix $(CHECK_TESTS)/, \
	check_hal.c)

check_hal_CFLAGS = $(CHECK_CFLAGS)
check_hal_LDADD = ../lib/libmtalk.so.0 \
	../lib/libmkprotobuf.so.0 \
	../lib/liblinuxcnchal.so.0 \
	../lib/liblinuxcncini.so.0

$(call TOOBJSDEPS, $(check_hal_SOURCES)) : EXTRAFLAGS += \
	$(CHECK_CFLAGS) -DULAPI -DBUILD_SYS_USER_DSO -fPIC -pthread

TARGETS += $(check_PROGRAMS)

CHECKS  += $(check_PROGRAMS) # for make check
C_CHECKS  += $(check_PROGRAMS)

#../bin/check_hal: $(check_hal_SOURCES)

../bin/check_hal: $(call TOOBJS, $(check_hal_SOURCES)) \
	$(check_hal_LDADD)
	$(Q)$(CC) -o $@ $^  $(CHECK_LIBS) -lpthread

USERSRCS += $(check_hal_SOURCES)
endif
